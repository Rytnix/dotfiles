"use strict";__filename="pages/options_defs.js",define(["require","exports","./async_bg","./options_base"],function(t,i,n,e){var r,s,u,o,h,f,a,c,l,d,v,p,m,g,_,b,x,N,y,M,k,w,T;Object.defineProperty(i,"__esModule",{value:true}),i.onKeyMappingsError=i.createNewOption=i.registerClass=i.savedStatus=i.exportBtn=i.saveBtn=i.Nt=i.Mt=i.Tt=i.Ot=i.Vt=i.At=void 0,e.r.en=Object.create(null),e.r.nt=[],e.r.prototype.E=function(t){var i,r;t.call(this),VApi&&(i=e.u.z[this.R],r=this.U(),(i in e.u.J?n.w(3,{key:i,val:r}):Promise.resolve(r)).then(function(t){if(VApi.z[i]=null!=t?t:r,"l"===i){var s=VApi.y().r;s&&s.querySelector("iframe.Omnibar")&&n.w(29,{key:i,val:null!=t?t:r})}e.r.et&&e.r.et()}))},e.r.prototype.j=function(t){var i,e;t.call(this),i=this.U(),"autoReduceMotion"===this.R?(e=1===i||0!==i&&matchMedia("(prefers-reduced-motion: reduce)").matches,VApi&&(VApi.z.m=e),n.toggleReduceMotion(e)):this.H()},e.r.Et=function(){return __awaiter(this,void 0,void 0,function*(){var t,i,r,s,u,o,h=e.r.en,f=[];for(r in e.u.b(),i=(t=h.optionalPermissions)&&t.Q(),yield Promise.all([e.u.S(),i]),h)!(s=h[r]).C&&s.Y()&&f.push(s.jt());if(f.length>0&&!confirm(e.t("dirtyOptions",[f.join("\n  * ")])))return false;for(r in h)if(!(s=h[r]).C&&!s.I())return false;for(r in n.N(8),h.vimSync.C||(yield h.vimSync.Q()),h.exclusionRules.C||(yield h.exclusionRules.Q()),u=[],h)(o=h[r]).C||u.push(o.Q());return yield Promise.all(u),n.N(0,8),true})},e.r.Ft=function(){var t,i=e.r.en;for(t in i)if(!i[t].C)return true;return false},e.r.prototype.jt=function(){var t=this.T;return this instanceof s?t.nextElementSibling.textContent:(t=(t=t.closest("tr")).querySelector(".caption")).innerText.replace(/[\r\n]/g,"")},e.r.prototype.tt=function(t,i){return t===i},r=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.D=function(){var t,r,s=this;this.V={min:(t=this.T.min)&&!isNaN(r=parseFloat(t))?r:null,max:(t=this.T.max)&&!isNaN(r=parseFloat(t))?r:null,default:0,G:i.Jt},e.delayBinding(this.T,"input",this.M),e.delayBinding(this.T,"focus",this.Pt.bind(this)),n.Z(function(){s.V.default=e.u.x[s.R]})},i.prototype.q=function(t){this.T.value=""+t},i.prototype.U=function(){return Math.round(parseFloat(this.T.value))},i.prototype.Pt=function(){var t=this,i=this.T,n=function(i){return t.Rt(i)},e=function(){i.removeEventListener("wheel",n,{passive:false}),i.removeEventListener("blur",e),t.Ht=0};this.Ht=0,i.addEventListener("wheel",n,{passive:false}),i.addEventListener("blur",e)},i.prototype.Rt=function(t){var i,n,e,r,s,u,o,h;if(t.preventDefault(),i=this.Ht,!((n=Date.now())-i<100&&n+99>i&&i))return this.Ht=n,s=(e=this.T).value,"function"==typeof(o=(r=(t.deltaY||t.deltaX)>0)?e.stepUp:e.stepDown)?(o.call(e),u=e.value,e.value=s):(h=(o=parseFloat)(e.step)||1,n=(+e.value||0)+(r?h:-h),isNaN(h=o(e.max))||(n=Math.min(n,h)),isNaN(h=o(e.min))||(n=Math.max(n,h)),u=""+n),this.Bt(u,i>0,false)},i.Jt=function(t){return isNaN(t)&&(t=this.default),t=null!=this.min?Math.max(this.min,t):t,null!=this.max?Math.min(this.max,t):t},i})(e.r),i.At=r,s=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.D=function(){var t=this.T,n=t.dataset.map;this.Dt=n?JSON.parse(n):t.dataset.allowNull?i.Lt:i.Ut,this.qt=this.Dt.length-1,this.qt>1&&"vimSync"!==this.R&&e.delayBinding(t,"input",this.onTripleStatusesClicked.bind(this),true),e.delayBinding(t,"change",this.M)},i.prototype.q=function(t){var i=true===t||t===this.Dt[this.qt];this.T.checked=i,this.T.indeterminate=this.qt>1&&t===this.Dt[1],this.It=i?this.qt:Math.max(0,this.Dt.indexOf(t))},i.prototype.U=function(){return this.T.indeterminate?this.Dt[1]:this.Dt[this.T.checked?this.qt:0]},i.prototype.onTripleStatusesClicked=function(t){this.It=i.ToggleTripleStatuses(this.It,t)},i.ToggleTripleStatuses=function(t,i){var n,e=i.target;return i.preventDefault(),n=2===t?1:t?0:2,e.indeterminate=2===t,e.checked=2===n,n},i.prototype.B=function(t){return this.T.dataset.map&&"boolean"==typeof t&&(t=this.Dt[t?this.qt:0]),t},i.zt=function(t,i){t.disabled=i;var n=t.nextElementSibling;n.tabIndex=i?-1:0,i?n.setAttribute("aria-disabled","true"):n.removeAttribute("aria-disabled")},i.Ut=[false,true],i.Lt=[false,null,true],i})(e.r),i.Vt=s,u=(function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.Ct=false,i}return __extends(i,t),i.prototype.D=function(){var t=this.T.dataset.converter||"",n=t?t.split(" "):[];e.delayBinding(this.T,"input",this.M),n.length>0&&(this.V={Gt:n,n:0,G:i.Kt})},i.prototype.K=function(){var i=this,n=t.prototype.K.call(this),e=this.V;return e&&(e.n=0,n?n=n.then(function(){e.n=e.G(i.L)===i.L?1:0}):e.n=e.G(this.L)===this.L?1:0),n},i.prototype.q=function(t,i){var n=this.Qt(t);true!==i?this.T.value=n:this.Bt(n,true,true)},i.prototype.Wt=function(){return this.T.value.trim().replace(/\xa0/g," ")},i.prototype.Qt=function(t){return t},i.prototype.U=function(){var t=this.Wt(),n=this.V;return t&&n&&n.G===i.Kt&&(n.n|=2,t=i.Kt.call(n,t),n.n&=-3),t},i.prototype.X=function(t){return this.Qt(t)!==this.Wt()},i.prototype.un=function(t,n){var e=!!t;(e||this.Ct)&&(this.Ct=e,i.un(t,n,this.T))},i.un=function(t,i,e){var r=!!t,s=e.classList,u=e.parentElement,o=e.nextElementSibling;o=o&&o.classList.contains("tip")?o:null,(r||o)&&n.Z(function(){r?(null==o&&((o=document.createElement("div")).className="tip",u.insertBefore(o,e.nextElementSibling)),o.textContent=t,null!==i&&s.add(i||"has-error")):(s.remove("has-error"),s.remove("highlight"),o&&o.remove())})},i.Kt=function(t){var i,n,e=this.Gt;if(e.indexOf("lower")>=0?t=t.toUpperCase().toLowerCase():e.indexOf("upper")>=0&&(t=t.toLowerCase().toUpperCase()),t=t.normalize(),e.indexOf("chars")<0||2&this.n&&!(1&this.n))return t;for(n of(i="",t.replace(/\s/g,"")))i.includes(n)||(i+=n);return i},i})(e.r),i.Ot=u,o=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.U=function(){var i=t.prototype.U.call(this);return i||this.q(i=e.u.x[this.R],true),i},i})(u),i.Tt=o,h=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.Qt=function(t){var i=this.T instanceof HTMLInputElement,n=JSON.stringify(t,null,i?1:2);return i?n.replace(/(,?)\n\s*/g,function(t,i){return i?", ":""}):n},i.prototype.U=function(){var i=t.prototype.U.call(this),n=null;if(i)try{n=JSON.parse(i)}catch(t){}else this.q(n=e.u.x[this.R],true);return n},i})(u),i.Mt=h,f=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.D=function(){t.prototype.D.call(this),this.Xt=true,this.Yt=this.Zt.bind(this),e.delayBinding(this.T,"focus",this.Yt)},i.prototype.Zt=function(){this.Yt&&(this.T.removeEventListener("focus",this.Yt),this.T.classList.remove("masked"),this.Yt=null,this.Xt=false,this.T.removeAttribute("placeholder"),this.K())},i.prototype.q=function(i,n){this.Xt?this.T.placeholder=e.t("clickToUnmask"):t.prototype.q.call(this,i,n)},i.prototype.Wt=function(){return this.Xt?this.L:t.prototype.Wt.call(this)},i})(u),i.Nt=f,u.prototype.Bt=r.prototype.Bt=function(t,i,n){var e,r,s,u,o,h,f,a,c,l,d,v=this.T,p=v.value,m="backward"!==v.selectionDirection?v.selectionEnd:v.selectionStart,g=false;if(i&&(this.$t=true,(g=document.activeElement!==v)&&v.focus(),document.execCommand("undo")),this.$t=n,null==m)v.select(),document.execCommand("insertText",false,t),g&&this.T.blur();else{for(r=v.scrollLeft,s=v.scrollTop,u=0,o=(e=i?v.value:p).length-1,h=t.length-1,f=Math.min(o,h);u<=f&&e[u]===t[u];)u++;for(f=Math.max(u,o-(h-u));f<=o&&e[o]===t[h];)o--,h--;if(v.setSelectionRange(u,o+1),a=t.slice(u,h+1),document.execCommand("insertText",false,a),g&&v.blur(),p!==e){for(u=0,o=p.length-1,h=t.length-1,f=Math.min(o,h);u<=f&&p[u]===t[u];)u++;for(f=Math.max(u,o-(h-u));f<=o&&p[o]===t[h];)o--,h--}m?m===p.length?(r=v.scrollWidth,s=v.scrollHeight,m=t.length):m<u||(m>o?m+=h-o:(l=(c=p.slice(0,m).split("\n")).length,(d=t.split("\n").slice(0,l)).length===l&&(d[l-1]=d[l-1].slice(0,c[l-1].length)),m=d.reduce(function(t,i){return t+i.length},0)+d.length-1)):r=s=0,v.scrollTo(r,s),v.setSelectionRange(m,m)}this.$t=false},h.prototype.tt=e.r.it,e.s.prototype.ft=function(t){var i,r,s,u,o;if(this.ut.length===t)for(s of(i=n.$("#exclusionToolbar"),r=n.$$("[data-model]",i),i.style.visibility=t?"":"hidden",r))(o=(u=e.r.en[s.id]).T.parentNode.style).visibility=t||u.C?"":"visible",o.display=!t&&u.C?"none":""},i.saveBtn=n.$("#saveOptions"),i.exportBtn=n.$("#exportButton"),i.createNewOption=(function(){var t,a,c,l,d=false;for(l of(i.savedStatus=function(t){return d=null!=t?t:d},t=function(){this.$t||((this.C=this.tt(this.U(),this.L))?d&&!e.r.Ft()&&(i.saveBtn.disabled=true,i.saveBtn.firstChild.data=e.t("115"),i.exportBtn.disabled=false,i.savedStatus(false),window.onbeforeunload=null):d||(window.onbeforeunload=T,i.savedStatus(true),i.saveBtn.disabled=false,i.saveBtn.firstChild.data=e.t("115_2"),i.exportBtn.disabled=true))},a={Number:r,Boolean:s,Text:u,NonEmptyText:o,JSON:h,MaskedText:f,ExclusionRules:e.s},c=function(i){var n=new(0,a[i.dataset.model])(i,t);return e.r.en[n.R]=n},e.r.F=true,n.$$("[data-model]")))c(l);return i.registerClass=function(t,i){a[t]=i},c})(),(c=(a=e.r.en.exclusionRules).rt).ondragstart=function(t){var i=t.target,n=document.activeElement;"input"!==n.localName?(a.ti=i,i.style.opacity="0.5"):n!==i&&t.preventDefault()},c.ondragend=function(){var t=a.ti;a.ti=null,t&&(t.style.opacity="")},c.ondragover=function(t){a.ti&&t.preventDefault()},c.ondrop=function(t){var i,n,e,r,s;t.preventDefault(),(i=a.ti)&&(n=(n=t.target).closest(".exclusionRule"))&&i!==n&&(a.rt.insertBefore(i,n),e=a.ut,r=i.querySelector(".pattern").vnode,s=n.querySelector(".pattern").vnode,e.splice(e.indexOf(r),1),e.splice(e.indexOf(s),0,r),a.M())};d=function(t){for(var i,n,e=new RegExp("^".concat("#").concat("!","[^\\n]*|^[^]"),"gm");i=e.exec(t);)if((n=i[0])&&"\n"!==n[0]){if("#"!==n[0])break;if("!"===n[1]&&"no-check"===n.slice(2).trim()){t=t.slice(0,i.index)+t.slice(i.index+n.length).trimLeft();break}}return t.replace(/\.activateMode(?:To)?/g,".activate")},(l=e.r.en.keyMappings).A=function(){var t=e.r.prototype.A.call(this);return t instanceof Promise?t.then(d):d(t)},l.B=function(t){return t=d(t),e.r.prototype.B.call(this,t)},i.onKeyMappingsError=function(t){true===t?l.un(e.t("ignoredNonEN"),null):l.un(t)},m=e.r.en.filterLinkHints,(v=e.r.en.linkHintCharacters).H=(p=e.r.en.linkHintNumbers).H=function(){this.un(!this.T.style.display&&this.L.length<4?"Too few characters for LinkHints":"")},m.H=function(){n.Z(function(){var t=m.U();p.T.style.display=t?"":"none",v.T.style.display=t?"none":"",s.zt(e.r.en.waitForEnter.T,!t),v.H(),p.H()})},e.delayBinding(m.T,"change",m.H,true),_=n.$$("input",(g=e.r.en.keyLayout).T),b=_[0],x=_[1],N=_[2],y=_[3],M=_[4],g.U=function(){var t,i=0;return b.checked?i=1:(i|=x.checked?8:0,i|=N.checked?2:N.indeterminate?4:0,i|=y.checked?16:y.indeterminate?512:0),i|=M.checked?128:M.indeterminate?64:0,256&(t=g.L)&&(-257&t)===i&&(i|=256),i},g.q=function(t){var i=!!(1&t);b.checked=i,x.checked=i||!!(8&t),N.checked=i||!!(2&t),N.indeterminate=!!(4&t),y.checked=i||!!(16&t),y.indeterminate=!!(512&t),M.checked=!!(128&t),M.indeterminate=!!(64&t),k=t,w(),e.r.et&&n.w(3,{key:"l",val:t}).then(function(i){VApi.z.l=null!=i?i:t,e.r.et&&e.r.et()})},w=function(t){var i,e=b.checked;s.zt(x,e),s.zt(N,e),s.zt(y,e),t&&(e?(x.checked=N.checked=y.checked=true,N.indeterminate=y.indeterminate=false):"number"!=typeof(i=g.A())||1&k||(k===i?g.K():g.q(k),n.Z(g.M)))},e.delayBinding(g.T,"input",function(t){var i,n,e,r=t.target;r===b?w(t):(n=r===N?2:r===y?16:r===M?128:8,(i=r===N?4:r===y?512:r===M?64:0)?(e=s.ToggleTripleStatuses(k&n?2:k&i?1:0,t),k=k&~(i|n)|(e>1?n:e?i:0)):k=k&~n|(r.checked?n:0))},true),e.r.en.vomnibarPage.H=function(){var t=this.T,i=this.L,r=i.startsWith(location.protocol)||i.startsWith("front/");if(n.wt<50)return n.Z(function(){t.style.textDecoration=r?"":"line-through"}),this.un(i===e.u.x.vomnibarPage?"":e.t("onlyExtVomnibar",[50]),null);r?this.un(""):i.startsWith("file:")?this.un(e.t("fileVomnibar"),"highlight"):/^http:\/\/(?!localhost[:/])/i.test(i)?this.un(e.t("httpVomnibar"),"highlight"):this.un("")},e.r.en.userDefinedCss.H=function(){var t=this;this.T.classList.contains("debugging")&&n.Z(function(){var i,e,r,s=VApi.y().r;for(i of n.$$("iframe",s))e=i.classList.contains("HUD"),(r=i.contentDocument.querySelector("style.debugged"))&&(e?r.remove():r.classList.remove("debugged"));t.T.classList.remove("debugging")})},e.r.en.autoReduceMotion.H=function(){var t=this;n.Z(function(){var i=t.L;n.toggleReduceMotion(2===i?matchMedia("(prefers-reduced-motion: reduce)").matches:i>0)})},e.r.en.passEsc.U=function(){return o.prototype.U.call(this).replace(/, /g,",")},e.r.en.passEsc.Qt=function(t){return t.replace(/,/g,", ")},T=function(){return setTimeout(function(){setTimeout(function(){var t,i;for(t of Object.values(e.r.en))t instanceof u&&t.Ct||(i="input"===(i=t.T).localName&&"checked"===i.type?i.parentElement:i).classList.toggle("highlight",!t.C)},300)},17),"Not saved yet"}});
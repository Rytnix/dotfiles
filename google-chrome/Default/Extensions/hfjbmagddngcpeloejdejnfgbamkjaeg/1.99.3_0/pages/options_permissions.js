"use strict";__filename="pages/options_permissions.js",define(["require","exports","./async_bg","./options_base","./options_defs"],function(n,o,e,r,i){var t,s,u,f,c,a,l,m,d,p,v,h,_,g,w,b,P,O,C;if(Object.defineProperty(o,"__esModule",{value:true}),o.fn=o.manifest=void 0,s=e.sn.permissions,u=function(n){if(!s)return function(){return e.w(25,{module:"permissions",name:n,args:[].slice.call(arguments)})};var o=s[n];return function(){var n=[].slice.call(arguments);return new Promise(function(r){n.push(function(n){var o=e.sn.runtime.lastError;return r(o?[void 0,o]:[n,void 0]),o}),o.apply(s,n)})}},f={contains:u("contains"),request:u("request"),remove:u("remove")},c="downloads.shelf",a="chrome://new-tab-page/*",(t={"clipboard-read":"opt_clipboardRead"})[l="chrome://*/*"]="opt_chromeUrl",t[a]="opt_cNewtab",t[c]="opt_closeShelf",m=t,d=e.$("#optionalPermissionsTemplate"),p=d.content.firstElementChild,v=d.parentElement,h=[],o.manifest=e.sn.runtime.getManifest(),_=o.manifest.optional_permissions||[],g=(function(n){function o(){var o=null!==n&&n.apply(this,arguments)||this;return o.U=function(){return h.map(function(n){return n.T.indeterminate?"1":n.T.checked?"2":"0"}).join("")},o.A=function(){return h.map(function(n){return n.L}).join("")},o}return __extends(o,n),o.prototype.D=function(){r.delayBinding(this.T,"change",this.M)},o.prototype.q=function(n){var o,e;for(o=0;o<h.length;o++)(e=h[o]).T.checked="2"===n[o],e.T.indeterminate="1"===n[o]},o.prototype.W=function(n){var o,t,s,u,m,d=this,p=[],v=[],_={},g=1,w=function(o){var e,t=h[o],u=+n[o];if(t.L===u)return"continue";e=t.an===a?"chrome://newtab/*":"",t.L=u,t.an===l&&r.u.O("allBrowserUrls")!==(2===u)&&r.u.P("allBrowserUrls",2===u),2===t.mn||(u?(t.an===c&&p.push("downloads"),(1===t.mn?v:p).push(t.an),e&&v.push(e),_[t.an]=t):(g++,f.remove(1===t.mn?{origins:e?[t.an,e]:[t.an]}:{permissions:t.an===c?["downloads",t.an]:[t.an]}).then(function(n){var o,e=n[1],r="Can not remove the permission %o :",u=e&&e.message||e;(e||!n[0])&&console.log(r,t.an,u),o=t.T.parentElement,i.Ot.un(e?r.replace("%o",t.an)+u:"",void 0,o),s()})))};for(o=0;o<h.length;o++)w(o);for(u of(t=function(n,o){var t,u,f,c=o[0],a=o[1];if((a||!c)&&console.log("Can not request permissions of %o :",n,a&&a.message||a),!c){for(u of(t=function(n){var o,t,s=_[n];return s?(s.L=0,o=s.T.parentElement,a?(t=(a&&a.message||JSON.stringify(a))+"",n.startsWith("chrome://")&&t.includes("Only permissions specified in the manifest")&&n.startsWith("chrome:")&&(t=r.t("optNeedChromeUrlFirst"),t=e.dn?t.replace("chrome:","edge:"):t),t=r.t("exc")+t,i.Ot.un(t,void 0,o),void e.Z(function(){o.title=t})):{value:i.Ot.un("",void 0,o)}):"continue"},n))if("object"==typeof(f=t(u)))return f.value;d.K()}s()},s=function(){--g>0||Promise.all(h.map(b)).then(function(){d.K()})},g+=(p.length&&1)+(v.length&&1),p.length&&f.request({permissions:p}).then(t.bind(0,p)),v.length&&f.request({origins:v}).then(t.bind(0,v)),[]))"clipboard-read"===u&&(m=navigator.clipboard,g++,m.readText().catch(function(){}).then(s));return s(),Promise.resolve(n)},o})(r.r),o.fn=g,i.registerClass("OptionalPermissions",g),w=function(){var n,o,i,t,s,u,f=document.createDocumentFragment();for(n of h)o=n.an,t=(i=document.importNode(p,true)).querySelector("input"),s=r.t(m[o]||"opt_".concat(o))||o,u="",o.startsWith("chrome:")&&(s=e.dn?s.replace("chrome:","edge:"):s,u=r.t("optOfChromeUrl").replace(e.dn?"chrome":"edge","edge")),t.value=o,o===a&&e.wt<80&&(u=r.t("requireChromium",[80]),t.disabled=true,t.checked=false,i.title=r.t("invalidOption",[r.t("beforeChromium",[80])])),i.lastElementChild.textContent=s+u,(1===_.length||2===_.length&&"en"===e.f)&&i.classList.add("single"),f.appendChild(i),n.T=t;v.appendChild(f),r.delayBinding(v,"input",P,true)},b=function(n){var o=n.mn,i=n.an;return(2===o?Promise.resolve([1,void 0]):f.contains(1===o?{origins:[i]}:{permissions:i===c?["downloads",i]:[i]})).then(function(o){var t,s=o[0];e.wt<72&&i===a&&(s=false),t=s?2===n.mn?s:i!==l||r.u.O("allBrowserUrls")?2:1:0,n.L=t})},P=function(n){var o,e,r,i,t=n.target,s=h.find(function(n){return n.T===t});s&&(o=t.checked,s.an!==l&&s.an!==a||(r=(e=s.an===a)?l:a,(i=h.find(function(n){return n.an===r}))&&(e&&o&&!i.T.checked?(i.T.checked=false,i.T.indeterminate=true):!e&&o&&t.indeterminate?t.indeterminate=false:(i.T.checked=o,i.T.indeterminate=false))))},O=["downloads"],e.dn&&O.push(a),O.push("cookies"),(_=_.filter(function(n){return!O.some(function(o){return"string"==typeof o?n===o:o.test(n)})})).length||0){for(C of _)h.push({an:C,mn:C.includes(":")?1:0,L:0,T:null});e.Z(w),Promise.all(h.map(b)).then(function(){e.Z(function(){v.dataset.model="OptionalPermissions",i.createNewOption(v).K()})})}else e.Z(function(){e.$("#optionalPermissionsBox").style.display="none"})});
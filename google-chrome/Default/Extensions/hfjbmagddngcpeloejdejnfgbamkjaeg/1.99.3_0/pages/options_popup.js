"use strict";__filename="pages/options_popup.js",define(["require","exports","./async_bg","./options_base"],function(n,t,e,u){var i,o,r,c,f,l,s,a,v,h,d,p,m,_,w,g,b,R,O,x,j,P,T,k,y,E,L,U,z,A,M,S,$;Object.defineProperty(t,"__esModule",{value:true}),r="",c=0,f=true,l=null,s=null,v=/^[a-z][\+\-\.\da-z]+:\/\//,h=e.$("#state-action"),d=e.$("#saveOptions"),m=(p=h.nextElementSibling).nextElementSibling,_=Object.create(null),g=function(n,t){return e.p(n,t)||""},b=(function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.ct=function(e,u){n.prototype.ct.call(this,t.vn(),u)},t.prototype.dt=function(n){return n.mt=n._t.pattern&&_[n._t.pattern]||false,k(n.mt)},t.prototype.q=function(e){var i,o,r;n.prototype.q.call(this,e),this.q=null,t.prototype.dt=u.s.prototype.dt,i=this.ut.filter(function(n){return n.yt}),c=(o=i.length>0)?2:1,o?(r=i[0].gt,R(true)):(this.ct("",false),r=this.ut[this.ut.length-1].gt),setTimeout(function(){r.focus()},67)},t.prototype.W=function(t){var e=n.prototype.W.call(this,t),u=P("".concat(i.tabId,"/reset/silent"));return Promise.all([e,u]).then(function(n){return n[0]})},t.prototype.St=function(t,e,u){var i=t._t.pattern===e,o=t.mt;n.prototype.St.call(this,t,e,u),i?t.mt=o:this.hn(t,e)},t.prototype.hn=function(n,e){var u,i=this,o=n.vt;e&&e!==t.vn()?(u=y(n))instanceof Promise?u.then(function(){i.hn(n,e)}):k(u)?o.title=o.style.color="":(o.style.color="red",o.title="Red text means that the pattern does not\nmatch the current URL."):o.title=o.style.color=""},t.vn=function(){var n=o.startsWith("http:")?"^https?://"+o.split("/",3)[2].replace(/[$()*+.?\[\\\]\^{|}]/g,"\\$&")+"/":o.startsWith(location.origin+"/")?":vimium:/"+new URL(o).pathname.replace("/pages",""):/^[^:]+:\/\/./.test(o)&&!o.startsWith("file:")?":"+o.split("/",3).join("/")+"/":":"+o;return _[n]||(_[n]=E("^"===n[0]?{t:1,v:n}:{t:2,v:n.startsWith(":vimium:")?o.split(/[?#]/)[0]:n.slice(1)})),t.vn=function(){return n},n},t})(u.s),R=function(n){var t,e;s.U(true),t=s.ut.filter(function(n){return n.yt&&!!n._t.pattern}),e=c,c=2,Promise.all(t.map(function(n){return null!==n.mt?n.mt:y(n)})).then(function(){O(e,n,t)})},O=function(n,t,e){var u,o,c=3===n,f=U(!!r,e);f&&(f=j(f)),t&&(l=n>=2?f:null),u=f===l,o=!!f&&f.length>2&&"^"===f[0],h.textContent=(c?f?g("137")+g(o?"138":"139"):g("140"):g(u?"141":"142")+g(f?o?"138":"139":u?"143":"143_2")).replace(" to be","")+g("colon")+g("NS"),p.className=f?"code":"",p.textContent=f?o?f.slice(2):f:g("143_3")+g(null!==f?"144":"145"),m.textContent=null!==i.lock&&!c&&u?g("147",[g(0!==i.lock?"144":"145")]):null!==i.lock?g("148"):"",d.disabled=u,d.firstChild.data=g(c?"115_3":u?"115":"115_2")},x=function(){if(!d.disabled)return e.N(8),s.Q().then(function(){e.N(0,8),c=3,z(),R(true),d.firstChild.data=g("115_3"),d.disabled=true,f=true})},j=function(n){var t,e,u;for(u of((t=(n=n.trim()).length>2&&n.startsWith("^"))&&(n=n.slice(1).trimLeft()),e=Object.create(null),n.split(" ")))e[u]=1;return(t?"^ ":"")+Object.keys(e).sort().join(" ")},P=function(n){return e.w(22,[n,i.tabId,i.frameId]).then(function(n){i.status=n[0],i.lock=n[1]})},T=function(n,t){t&&t.preventDefault();var e=t&&(t.ctrlKey||t.metaKey);P("".concat(i.tabId,"/").concat(n)).then(function(){e?(z(),R(false)):window.close()})},k=function(n){return!!n&&(2===n.t?o.startsWith(n.v)||!!r&&r.startsWith(n.v):n.v.test(o)||!!r&&n.v.test(r))},y=function(n){var t,u=n._t.pattern,i=_[u];return i?n.mt=i instanceof Promise?i.then(function(t){return n.mt=t}):i:(t=e.w(23,u),_[u]=n.mt=t.then(function(t){return _[u]=n.mt=E(t)}))},E=function(n){return 2===n.t?{t:n.t,v:n.v}:3===n.t?{t:n.t,v:new URLPattern(n.v)}:{t:n.t,v:new RegExp(n.v,"")}},L=function(){var n,t,e,u=i.exclusions,o=u.rules,r=u.matchers;for(n=0,t=o.length;n<t;n++)_["__proto__"!==(e=o[n].pattern)?e:"_"]=E(r[n])},U=function(n,t){var e,u,i,c="";for(e of t)if((u=e.mt)&&(2===u.t?o.startsWith(u.v):u.v.test(o))){if(0===(i=e._t.passKeys).length||w||"^"===i[0]&&i.length>2)return i;c+=i}return!c&&n&&o.lastIndexOf("://",5)<0&&!v.test(o)&&r?U(false,t):c||null},z=function(){a=2!==i.status?"Disable":"Enable";var n=e.$("#toggleOnce"),t=n.nextElementSibling;e.Z(function(){n.firstElementChild.textContent=(g(a)||a)+(null!==i.lock?"":g("Once")),n.onclick=T.bind(null,a),p.id="state-value",t.classList.toggle("hidden",null===i.lock),null!==i.lock&&(t.firstElementChild.onclick=T.bind(null,"Reset"))})},A=function(n){var t=e.$(".options-link"),u=location.origin+"/pages/options.html";n.startsWith(u)?e.Z(function(){t.nextElementSibling.remove(),t.remove()}):(t.href!==u&&e.Z(function(){t.href=u}),t.onclick=function(n){n.preventDefault(),e.w(15,{u:u,p:true}).then(function(){window.close()})})},M=function(){i.os||window.addEventListener("keydown",function(n){n.altKey&&(88===n.keyCode||null!==i.lock&&90===n.keyCode)&&!(n.ctrlKey||n.metaKey||e.pn(n))&&(n.preventDefault(),n.stopImmediatePropagation(),T(88===n.keyCode?a:"Reset"))}),(s=new b(e.$("#exclusionRules"),function(){if(f){f=false;var n=e.$("#helpSpan");n&&(n.nextElementSibling.style.display="",n.remove()),d.removeAttribute("disabled"),d.firstChild.data=g("115_2")}R(c<2)})).K()},e.w(20).then(function(n){var t,c;if(t=(i=n).url,c=e.$("#blocked-msg"),e.N(1),!i.runnable)return $(c),A(t),e.Z(u.showI18n),void e.Z(S);e.Z(function(n){c.remove(),c=null,e.toggleReduceMotion(i.reduceMotion),n.textContent=i.ver},e.$("#version")),r=i.topUrl||t,o=i.frameUrl||r,w=i.exclusions.onlyFirst,u.u.x={exclusionRules:i.exclusions.defaults},u.h({exclusionRules:i.exclusions.rules}),L(),i.exclusions=null,d.onclick=x,document.addEventListener("keyup",function(n){var t,e;13===n.keyCode&&((t=n.target)instanceof HTMLAnchorElement?t.hasAttribute("href")||setTimeout(function(n){n.click(),n.blur()},0,t):(n.ctrlKey||n.metaKey)&&(e=!f&&x())&&e.then(function(){setTimeout(window.close,300)}))}),A(t),z(),M(),e.Z(u.showI18n),u.e&&e.Z(u.e),e.Z(S)}),S=function(){var n=document.documentElement;n.classList.remove("loading"),n.style.width="",n.style.height=""},$=function(n){var t,u,o,r,c,f,l=i.url||"",s=document.body;s.innerText="",n.style.display="",n.querySelector("#version").textContent=i.ver,t=n.querySelector("#refresh-after-install"),i.tabId<0||!l||!/^(ht|s?f)tp/i.test(l)?t.remove():!e.dn&&((o=(u=navigator.userAgentData)&&(u.brands||u.uaList))?o.find(function(n){return n.brand.includes("Opera")}):/\b(Opera|OPR)\//.test(navigator.userAgent))&&/\.(google|bing|baidu)\./.test(l.split("/",4).slice(0,3).join("/"))&&(n.querySelector("#opera-warning").style.display=""),s.appendChild(n),(r=i.unknownExt)&&((c=e.$("#injection-refused")).style.display="",c.nextElementSibling.remove(),e.$("#doAllowExt").onclick=function(){this.onclick=null,e.w(21,[i.tabId,r]).then(function(){setTimeout(function(){location.reload()},0)})}),(f=e.$("#retryInject"))&&(/^(file|ftps?|https?):/.test(l)&&i.tabId>=0?f.onclick=function(n){n.preventDefault(),e.w(6,i.tabId).then(function(){window.close()})}:(f.nextElementSibling.remove(),f.remove()))}});